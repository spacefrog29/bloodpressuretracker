# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

```bash
# Install dependencies
npm install

# Start development server (runs on port 3000)
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview
```

## Architecture Overview

This is a Vue 3 blood pressure tracking application using Composition API with the following structure:

### Authentication & State Management
- **Authentication**: Managed via the `useAuth()` composable in `src/composables/useAuth.js`
  - Singleton pattern using module-level refs for `user` and `loading` state
  - Provides: `signIn()`, `signUp()`, `signOut()`, `updatePassword()`, `checkUser()`, `isAuthenticated`
  - Auth state listener automatically updates the global `user` ref on auth changes
- **Router Guards**: `src/router/index.js` implements navigation guards that check authentication status before allowing access to protected routes

### Data Flow
- **Supabase Client**: Configured in `src/services/supabase.js` with hardcoded credentials (currently committed)
- **Database Table**: `blood_pressure_readings` with columns: `id`, `reading_date`, `systolic`, `diastolic`, `heart_rate`, `created_at`
- **Row Level Security (RLS)**: Enabled with simple policy allowing all authenticated users to access all data (not user-scoped)

### Component Architecture
- **BloodPressureTracker.vue**: Main component handling CRUD operations for blood pressure readings
  - Local state management (no Vuex/Pinia)
  - Direct Supabase queries for all database operations
  - Computed properties for statistics (averages calculated client-side)
  - CSV export functionality built-in
- **Views**: Thin wrappers around components
  - `DashboardView.vue`: Wrapper for BloodPressureTracker component
  - `AdminView.vue`: Password management, account info, database stats, and bulk delete operations
  - `LoginView.vue`: Authentication forms

### BP Category Calculation
Categories are computed client-side in `BloodPressureTracker.vue:123-129`:
- Normal: systolic < 120 AND diastolic < 80
- Elevated: systolic < 130 AND diastolic < 80
- Stage 1 High: systolic < 140 OR diastolic < 90
- Stage 2 High: systolic < 180 OR diastolic < 120
- Crisis: systolic >= 180 OR diastolic >= 120

## Supabase Setup Required

Before running the application, you must create the database table in your Supabase project:

```sql
create table blood_pressure_readings (
  id bigint generated by default as identity primary key,
  reading_date date not null,
  systolic integer not null,
  diastolic integer not null,
  heart_rate integer not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

alter table blood_pressure_readings enable row level security;

create policy "Allow authenticated users full access"
  on blood_pressure_readings
  for all
  using (auth.role() = 'authenticated');
```

## Key Implementation Notes

- **Date Formatting**: Uses `en-GB` locale for displaying dates (DD/MM/YYYY format)
- **Form Validation**: Client-side only, no backend validation
- **Error Handling**: Error messages stored in local component state and displayed inline
- **No TypeScript**: Project uses plain JavaScript with Vue 3
- **No Testing**: No test framework configured
- **Credentials**: Supabase URL and anon key are currently hardcoded in `src/services/supabase.js` (should be moved to environment variables for production)

## Multi-User Considerations

Current RLS policy allows all authenticated users to see all data. For true multi-user support:
1. Add `user_id` column to `blood_pressure_readings` table
2. Update RLS policies to filter by `auth.uid()`
3. Modify all Supabase queries to filter by current user
